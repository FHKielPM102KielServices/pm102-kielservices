<!DOCTYPE html>
<html>
<head>
    <style type="text/css">
        #map{
            height:500px;
        }
    </style>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel='stylesheet' href='/stylesheets/placestyle.css' />
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC_UOVJ2Fbk-TnFn2P8EN4KGc5ecfHErmg&libraries=places"
            type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript">
        var map;
        var infowindow;
        $(document).ready(function () {
            navigator.geolocation.getCurrentPosition(initialise);
        })
        function initialise(position) {
           //  var pyrmont = {lat: -33.867, lng: 151.195};
            var pos;
            // if (navigator.geolocation) {

                pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                }
                map = new google.maps.Map(document.getElementById('map'), {
                    center: pos,
                    zoom: 12
                });
                var marker = new google.maps.Marker({
                    position: pos,
                    map: map,
                });

                infowindow = new google.maps.InfoWindow();
                var service = new google.maps.places.PlacesService(map);
                service.nearbySearch({
                    location: pos,
                    radius: 1000,
                    type: ['{{ subject}}']
                }, processResults);
                console.log('{{ subject}}');

            //   }

        }

        function processResults(results, status) {

            if (status === google.maps.places.PlacesServiceStatus.OK) {
                for (var i = 0; i < results.length; i++) {
                    details(results[i]);
                }
            }
        }
        function details(place) {
            var request = {
                placeId: place.place_id
            };
            var service = new google.maps.places.PlacesService(map);
            service.getDetails(request, createMarker);
        }
        function createMarker(place) {
            var placesList = document.getElementById('places');
            var placeLoc = place.geometry.location;
            placesList.innerHTML += '<tr class="even"><td><a href="'+place.website+'"><img width="25" src=  '+ place.photos[0].getUrl({'maxWidth': 200, 'maxHeight': 100})   +'></a> </td><td style="font-weight: bold;color: blue "><img width="10" src=  '+ place.icon    +'>&nbsp;&nbsp;' + place.name +'</td><td><a href="'+place.website+'">  '+ place.website    +'</a> </td><td> '+ place.vicinity  +' </td><td> '+ place.international_phone_number    +'</td><td> ' + place.opening_hours.periods[2].open.hours +' - ' + place.opening_hours.periods[2].close.hours   +'</td></tr>';
          //      placesList.innerHTML += '<td> ' + place.opening_hours["weekday_text"][0]    +'</td></tr>';
            console.log(JSON.stringify(place.photos[1], null, 2));
            var marker = new google.maps.Marker({
                map: map,
                position: place.geometry.location
            });

            google.maps.event.addListener(marker, 'click', function() {
                infowindow.setContent(place.name);
                infowindow.open(map, this);
            });
        }




    </script>
</head>
<body>
<p>{{subject}}</p>



<br>
<!-- <ul id="places"></ul>-->


<div style="width: 100%">
    <div style="float: left; width: 70%" >
        <table cellspacing='0' id="places" width="90%">
            <tr><th  width="5%"></th><th  width="15%">Name</th><th  width="12%">WebSite</th><th  width="15%">Address</th><th width="15%">Tel</th><th width="5%">Opening Hours</th></tr><!-- Table Header -->


        </table>
    </div>
    <div id="map"  style="float: left;width: 30%"></div>
</div>

</body>
</html>
